YUI.add("flickr-products-subscriptions-orders-create-creator",function(r,s){"use strict";var t={1:"Flickr Pro",2:"Flickr Pro",3:"Flickr Pro",4:"Ad Free",6:"Ad Free",7:"Flickr Pro",8:"Flickr Pro"},a={1:"3 months",2:"1 year",3:"2 years",4:"1 year",6:"1 month",7:"1 month",8:"1 year"};r.namespace("ModelCreators")["flickr-products-subscriptions-orders-create"]={run:function(t,a){var e=this;return r.Promise.all([a.callAPI("flickr.subscriptions.braintree.initiateSubscription",this._processParams(t)),a.getModelRegistry("flickr-products-orders-models")]).then(function(r){return e._processResponse(r,t)},r.FetcherErrorLogger(s))},_processParams:function(r){var s={};return r=r||{},s.plan_type=r.planType,s.cache_bust=Date.now(),s},_processResponse:function(r,s){var e,o=r[0].subscription,n=r[1];return o?e=n.exists(o.subscriptionId)?n.get(o.orderId):n.add({id:o.subscriptionId||null,productName:o.planData.productClassId&&s.planType?t[s.planType]+" "+a[s.planType]:o.planData.name,subscriptionDuration:o.planData.length||0,orderId:o.subscriptionId||null,costTotal:parseFloat(o.planData.price)||0,costProducts:parseFloat(o.planData.costProducts)||0,costShipping:parseFloat(o.planData.costShipping)||0,costTax:o.planData.costTax||0,statusPrint:o.planData.statusPrint||null,statusPayment:o.planData.statusPayment||null,orderType:"subscription"}):console.warn("flickr-products-subscriptions-orders-create-creator: No API response?"),e}}},"@VERSION@",{requires:["flickr-promise","flickr-products-orders-models"],optional:[]});YUI.add("flickr-products-subscriptions-getSubscriptionDetails-fetcher",function(t,r){"use strict";var s,e;s={1:"Flickr Pro",2:"Flickr Pro",3:"Flickr Pro",4:"Ad Free",6:"Ad Free",7:"Flickr Pro",8:"Flickr Pro"},e={1:"3 months",2:"1 year",3:"2 years",4:"1 year",6:"1 month",7:"1 month",8:"1 year"},t.namespace("ModelFetchers")["flickr-products-subscriptions-getSubscriptionDetails"]={run:function(s,e){var o=this;return t.Promise.all([e.callAPI("flickr.subscriptions.braintree.getSubscriptionDetails",this._processParams(s)),e.getModelRegistry("flickr-products-orders-models"),e.getModelRegistry("flickr-subscriptions-coupons-models"),e.getModelRegistry("flickr-products-discounts-models")]).then(function(t){return o._processResponse(t,s)},t.FetcherErrorLogger(r))},_processResponse:function(r,o){var i,a=r[0].subscriptionData,n=r[1],c=r[2],d=r[3];return a?(i=n.exists(a.orderId)?n.get(a.orderId):n.add({id:a.data.id||null,productName:s[a.data.type]+" "+e[a.data.type],prettyName:a.planInfo.prettyName,prettyNameDuration:a.planInfo.prettyNameDuration,subscriptionDuration:a.planInfo.length||0,orderId:a.data.id||null,costTotal:parseFloat(a.planInfo.price)||0,costProducts:parseFloat(a.planInfo.costProducts)||0,costShipping:0,costTax:a.planInfo.costTax||0,statusOrder:a.data.status||0,statusPayment:a.statusPayment||null,paymentMethodId:a.data.paymentMethodId||null,orderType:"subscription"}),a.data.discounts&&a.data.discounts[0]&&a.data.discounts[0].discount&&i.setValue("coupon",t.ProductsAPIHelper.parseSubscriptionCoupon({subscriptionId:a.data.id,discount:a.data.discounts[0].discount,stat:r[0].stat},{couponRegistry:c,discountRegistry:d}))):console.warn("flickr-products-subscriptions-orders-create-creator: No API response?"),i},_processParams:function(t){return{subscription_id:t.orderId||t.id}}}},"@VERSION@",{requires:["flickr-promise","products-api-helper"]});YUI.add("flickr-products-shippingType-updater",function(r,e){"use strict";r.namespace("ModelUpdaters")["flickr-products-shippingType-updater"]={run:function(p,i){var o={order_id:p.orderId,shipping_type:p.shippingType};return p.countryCode&&(o.country_code=p.countryCode),i.callAPI("flickr.products.orders.setShippingType",o).then(null,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("flickr-products-orders-getOrder-fetcher",function(r,e){"use strict";r.namespace("ModelFetchers")["flickr-products-orders-getOrder"]={run:function(s,o){var t=this;return new r.FlickrPromise({response:o.callAPI("flickr.products.orders.getOrder",this._processParams(s)),orderRegistry:o.getModelRegistry("flickr-products-orders-models"),couponRegistry:o.getModelRegistry("flickr-products-coupons-models"),discountRegistry:o.getModelRegistry("flickr-products-discounts-models"),itemRegistry:o.getModelRegistry("products-order-item-models"),itemPriceRegistry:o.getModelRegistry("products-order-item-price-models")}).then(function(r){return t._processResponse(r,s,o)},r.FetcherErrorLogger(e))},_processResponse:function(e,s,o){var t,i,d,c,u,p,n;return n=e.response,t=e.orderRegistry,i=e.couponRegistry,d=e.discountRegistry,c=e.itemRegistry,u=e.itemPriceRegistry,p={orderRegistry:t,orderItemRegistry:c,itemPriceRegistry:u,couponRegistry:i,discountRegistry:d},r.ProductsAPIHelper.parseOrder(n.order,p)},_processParams:function(r){var e={};return e.order_id=r.orderId||r.id,e}}},"@VERSION@",{requires:["flickr-promise","products-api-helper"],optional:["flickr-products-orders-models","flickr-products-coupons-models","flickr-products-discounts-models","products-order-item-models","products-order-item-price-models"]});YUI.add("flickr-products-orders-deletor",function(r,e){"use strict";r.namespace("ModelDeletors")["flickr-products-orders-deletor"]={run:function(c,o){return o.callAPI("flickr.products.orders.cancel",c).then(null,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-products-orders-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return"subscription"===e.type?t.ModelFetchers["flickr-products-subscriptions-getSubscriptionDetails"].run(e,this.appContext):t.ModelFetchers["flickr-products-orders-getOrder"].run(e,this.appContext)},create:function(e){return e.planType?t.ModelCreators["flickr-products-subscriptions-orders-create"].run(e,this.appContext):t.ModelCreators["flickr-products-orders-create"].run(e,this.appContext)},delete:function(e,r){return t.ModelDeletors["flickr-products-orders-deletor"].run({order_id:e},this.appContext)},update:function(e,r){var o;return r.countryCode?(o={shippingType:this.getValue(e,"shippingType"),orderId:this.getValue(e,"orderId"),countryCode:r.countryCode.newVal},t.ModelUpdaters["flickr-products-shippingType-updater"].run(o,this.appContext)):r.shippingType?(o={shippingType:r.shipMethod?r.shipMethod.newVal:this.getValue(e,"shippingType"),orderId:this.getValue(e,"orderId"),countryCode:this.getValue(e,"countryCode")},t.ModelUpdaters["flickr-products-shippingType-updater"].run(o,this.appContext)):t.Promise.resolve()}},attributes:{orderId:{},bookId:{},isCouponApplied:{},isFreeOrder:{},costTotal:{setter:function(t){return t?parseFloat(t).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(t){return parseFloat(0).toFixed(2)}},shippingType:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},dateCreate:{validator:function(e,r){return t.AttributeHelpers.validateDate(e)},setter:function(e){return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(e){return t.moment()}},costProducts:{setter:function(t){return t?parseFloat(t).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(t){return parseFloat(0).toFixed(2)}},costShipping:{setter:function(t){return t?parseFloat(t).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(t){return parseFloat(0).toFixed(2)}},costDiscount:{setter:function(t){return t?parseFloat(t).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(t){return parseFloat(0).toFixed(2)}},costTax:{setter:function(t){return t?parseFloat(t).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(t){return parseFloat(0).toFixed(2)}},items:{isListProxy:!0},statusOrder:{},statusPrint:{},statusPayment:{},paymentMethodId:{},userId:{},orderType:{},productName:{},prettyName:{},prettyNameDuration:{},subscriptionDuration:{},bookPreviewPdf:{},trackingNum:{},trackingUrl:{},coupon:{isModel:!0},countryCode:{getter:function(t){return t||"US"},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultValue:"US"}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-products-orders-create-creator","flickr-products-subscriptions-orders-create-creator","flickr-products-subscriptions-getSubscriptionDetails-fetcher","flickr-products-shippingType-updater","flickr-products-orders-create-creator","flickr-products-orders-getOrder-fetcher","flickr-products-orders-deletor"]});YUI.add("flickr-products-orders-applyCoupon-creator",function(r,e){"use strict";r.namespace("ModelCreators")["flickr-products-orders-applyCoupon"]={run:function(o,s){return new r.FlickrPromise({response:s.callAPI("flickr.products.orders.applyCoupon",this._processParams(o)),orderRegistry:s.getModelRegistry("flickr-products-orders-models"),couponRegistry:s.getModelRegistry("flickr-products-coupons-models"),discountRegistry:s.getModelRegistry("flickr-products-discounts-models"),itemRegistry:s.getModelRegistry("products-order-item-models"),itemPriceRegistry:s.getModelRegistry("products-order-item-price-models")}).then(this._processResponse,r.FetcherErrorLogger(e))},_processParams:function(r){var e={};return e.order_id=r.orderId,e.coupon_code=r.couponCode,e},_processResponse:function(e){var o,s,t,i,d,c,p;return p=e.response,o=e.orderRegistry,s=e.couponRegistry,t=e.discountRegistry,i=e.itemRegistry,d=e.itemPriceRegistry,c={orderRegistry:o,orderItemRegistry:i,itemPriceRegistry:d,couponRegistry:s,discountRegistry:t},r.ProductsAPIHelper.parseOrder(p.order,c).getValue("coupon")}}},"@VERSION@",{requires:["flickr-promise","products-api-helper"],optional:["flickr-products-orders-models","flickr-products-coupons-models","flickr-products-discounts-models","products-order-item-models","products-order-item-price-models"]});YUI.add("flickr-braintree-createSubscription-creator",function(r,e){"use strict";r.namespace("ModelCreators")["flickr-braintree-createSubscription-create"]={run:function(s,t){var c=this;return r.Promise.all([t.callAPI("flickr.subscriptions.braintree.createSubscription",this._processParams(s))]).then(function(r){return c._processResponse(r,s)},r.FetcherErrorLogger(e))},_processParams:function(r){var e={};return r=r||{},e=r,e.cacheBust=Date.now(),e},_processResponse:function(r,e){var s=r[0].subscriptionData;return s||console.warn("flickr-braintree-createSubscription-creator: No API response?"),s}}},"@VERSION@",{requires:["flickr-promise","flickr-products-orders-models"],optional:[]});YUI.add("flickr-subscriptions-transferSubscriptions-updater",function(r,s){"use strict";r.namespace("ModelUpdaters")["flickr-subscriptions-transferSubscriptions-updater"]={run:function(i,t){return t.callAPI("flickr.subscriptions.transferSubscriptions",i).then(null,r.FetcherErrorLogger(s))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("flickr-products-braintree-paymentDefault-updater",function(e,r){"use strict";e.namespace("ModelUpdaters")["flickr-products-braintree-paymentDefault-updater"]={run:function(t,a){return a.callAPI("flickr.subscriptions.braintree.updatePaymentDefault",t).then(null,e.FetcherErrorLogger(r))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("flickr-subscriptions-braintree-deletePaymentMethod-deletor",function(e,r){"use strict";e.namespace("ModelDeletors")["flickr-subscriptions-braintree-deletePaymentMethod-deletor"]={run:function(t,i){var n={};return n.payment_method_id=t.id,e.Promise.all([i.callAPI("flickr.subscriptions.braintree.deletePaymentMethod",n)]).then(null,e.FetcherErrorLogger(r))},_processResponse:function(e,r){}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("flickr-products-shipping-fetcher",function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-products-shipping"]={run:function(s,t){var o=this;return e.Promise.all([t.callAPI("flickr.products.orders.getShippingAddress",this._processParams(s)),t.getModelRegistry("products-address-models")]).then(function(e){return o._processResponse(e,s)},e.FetcherErrorLogger(r))},_processResponse:function(e,r){var s,t,o;t=e&&e[0]&&e[0].orderInfo&&e[0].orderInfo.shippingAddress?e[0].orderInfo.shippingAddress:{},o={orderId:e[0].orderInfo.orderId,id:r.id,city:t.city||"",countryCode:t.countryCode||"US",firstName:t.firstName||"",lastName:t.lastName||"",phone:t.phone||"",postalCode:t.postalCode||"",state:t.state||"",street1:t.street1||"",street2:t.street2||""},(s=e[1]).exists(r.id)?(delete o.id,s.setValues(r.id,o)):s.add(o)},_processParams:function(e){var r={};return r.order_id=e.id,r}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["products-address-models"]});YUI.add("flickr-products-orders-setShippingAddress-updater",function(r,e){"use strict";function t(r){var e;if(!r||!r.orderInfo)throw new Error(-2);if(void 0!==(e=r.orderInfo).isValidAddress&&"false"===e.isValidAddress)throw new Error(-1);return!0}r.namespace("ModelUpdaters")["flickr-products-orders-setShippingAddress"]={run:function(s,o){var i,d=s;return i={order_id:d.id,first_name:d.firstName,last_name:d.lastName,street1:d.street1,street2:d.street2,city:d.city,state:d.state,postal_code:d.postalCode,country_code:d.countryCode||"US",phone:d.phone,shipping_type:d.shippingType},o.callAPI("flickr.products.orders.setShippingAddress",i).then(t,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("flickr-products-orders-clearAddress-deletor",function(r,e){"use strict";function s(r){return!0}r.namespace("ModelDeletors")["flickr-products-orders-clearAddress"]={run:function(t,d){var o;return o={order_id:t.orderId,first_name:"",last_name:"",street1:"",street2:"",city:"",state:"",postal_code:"",country_code:"US",phone:"",clear_shipping_address:1},d.callAPI("flickr.products.orders.setShippingAddress",o).then(s,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("products-address-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-products-shipping"].run(e,this.appContext)},update:function(e,r){var n={},i=this;return Object.keys(this.attributes).forEach(function(t){n[t]=void 0!==r[t]?r[t].newVal:i.getValue(e,t)}),this.appContext.getModel("flickr-products-orders-models",e).then(function(e){return n.shippingType=e.getValue("shippingType"),t.ModelUpdaters["flickr-products-orders-setShippingAddress"].run(n,i.appContext)})},delete:function(e){return t.ModelDeletors["flickr-products-orders-clearAddress"].run({orderId:this.getValue(e,"orderId")},this.appContext)}},isComplete:function(t){var e=Object.keys(this.attributes),r=["cacheBust","street2"],n=this.proxy(t);return e.every(function(t){return!(r.indexOf(t)<0&&""===n.getValue(t))})},attributes:{cacheBust:{},orderId:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},firstName:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},lastName:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},street1:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},street2:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},city:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},state:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){var r;return 2===(r=t.AttributeHelpers.coerceString(e)).length&&(r=r.toUpperCase()),r}},postalCode:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},countryCode:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultValue:"US"},phone:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}}}})},"@VERSION@",{requires:["flickr-model-registry"],optional:["flickr-products-shipping-fetcher","flickr-products-orders-setShippingAddress-updater","flickr-products-orders-clearAddress-deletor"]});